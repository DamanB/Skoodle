<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type='text/javascript' src="/js/classes.js"></script>
    <script type='text/javascript' src="/js/data.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <title>Skoodle</title>
</head>

<style>
    h2 {
        text-align: center;
    }

    form {
        text-align: center;
    }

    label {
        display: inline-block;
        width: 200px;
        margin-right: 0px;
        text-align: center;
    }

    button {
        display: inline-block;
        position: absolute;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
    }
</style>

<body>

    <script>
        $(document).ready(function () {
            $("#error").hide();
            //Get data
            var data = sessionStorage.getItem("EmployeeList");
            if (!data) {
                //Init data
                console.log("Initializing data for first time run");
                InitData();
                data = sessionStorage.getItem("EmployeeList");
                if (!data) {
                    console.log("ERROR: Init data not found");
                }
            }
        })

        //Perform login check 
        $(document).on('click', '#login', function () {
            var username = $("#id").val();
            var password = $("#pw").val();
            console.log("Attempted login with: " + username + " - " + password);
            //Authenticate
            elistRaw = sessionStorage.getItem("EmployeeList");
            plistRaw = sessionStorage.getItem("ParentList");
            var valid = false;
            elist = JSON.parse(elistRaw);
            plist = JSON.parse(plistRaw);
            //check empty
            if (elist) {
                valid = auth(username, password, elist)
            }
            if (!valid && plist) {
                valid = auth(username, password, plist)
            }
            if (valid)
            {
                //TODO LOGIN REDIRECT
            }
            else{
                $("#error").show();
            }

        });
        function auth(uname, pword, list) {
            list.foreach(function (user) {
                if (user.username === username) {
                    if (user.password === password) {
                        console.log("Successfull User Login");
                        sessionStorage.setItem('user', JSON.stringify(user));
                        return true;
                    }
                }
            })
            return false;
        }
    </script>

    <div id="logo">
        Skoodle
    </div>
    <!-- Hello Frands -->
    <!-- test -->
    <h2>Enter the following information in the following textbox</h2>

    <form>
        <label for="id">ID:</label><br>
        <input type="text" id="id" name="id">

        <br><br>

        <label for="pw">Password:</label><br>
        <input type="text" id="pw" name="pw">

        <br><br>

        <!-- 
                Change to this for actual, working submit button 
                    <input type="submit" value="Submit">
            -->
        <br><br>
    </form>

    <button id="login">Log-In</button>
    <br><br>
    <span id="error" style="display: none; color: red;">Invalid username or password!</span>
    <br><br>
    <a href="/pages/parentRegister.html">
        <button>Register as Parent</button>
    </a>
</body>

</html>