<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/generic.css">
    <link rel="stylesheet" href="/css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type='text/javascript' src="/js/classes.js"></script>
    <script type='text/javascript' src="/js/data.js"></script>
    <title>skoodle: Secretary's Manage Attendance Reports</title>
</head>

<body>
    <script>
        var user;
        var withRents = [];
        var date;

        //set header
        $(document).ready(function () {
            user = Object.assign(new Secretary, getActiveUser());
            $("#username").text(user.type.toUpperCase() + ": " + user.username);
            $("#name").text("Hello " + user.name + "!");

            //Get submitted attendances
            date = new Date(); //get Todays date
            var submitted = user.getSubmittedAttendences(date);
            $("#listOfSubmittedAttendances").empty();
            
            //show list
            submitted.forEach(function (att) {
                //show list of submitted
                $("#listOfSubmittedAttendances").append(
                    "<li>" + att.className + "</li>"
                )

                //populate dropdown
                $("#classSelect").append("<option value=" + att.className + ">" + att.className + "</option>");

            })

            //populate the report field
            populateTheAbsences(date);
        });

        //Logout button
        $(document).on('click', "#logout", function () {
            removeActiveUser();
            window.location.href = "/index.html";
        }); 

        //TODO
        $(document).on('change', "#listOfSubmittedAttendances", function () {
            //populate with the att
        });

        $(document).on('click', "#notify", function () {
            //populate with the att
            withRents.forEach(function(abs){
                var notif = abs.student.name + " with ID: " + abs.student.Stdid + " was absent on " + abs.date.toString.subString(0,10) + " for " + abs.className;
                console.log(notif);
                abs.student.getParent.notifications.push(notif);
            });
        });


        function populateTheAbsences(date){
            var absNotDeclared = user.getAbsentEntries(date);
            absNotDeclared.forEach(function(abs){
                if (abs.student.getParent())
                {
                    withRents.push(abs);
                    $("#notDeclaredwithRentsList").append(
                        '<tr><td>' + abs.student.Stdid + '</td>' + '<td>' + regStud.name + '</td><td>' + abs.status + '</td></tr>'
                    );
                }
                else
                {
                    $("#notDeclaredwithoutRentsList").append(
                        '<tr><td>' + abs.student.Stdid + '</td>' + '<td>' + regStud.name + '</td><td>' + abs.status + '</td></tr>'
                    );
                }
            })

            var absDec = getAbsentDeclaredEntries(date);
            absDec.forEach(function(abs){
                $("#declaredList").append(
                        '<tr><td>' + abs.student.Stdid + '</td>' + '<td>' + regStud.name + '</td><td>' + abs.status + '</td></tr>'
                );
            });
        }

    </script>

    <div id="logo">
        Skoodle
    </div>

    <div class="nameLabel">
        <span id="username"></span><br>
        <span id="name"></span>
    </div>

    <div id="logout">
        <button>Logout</button>
    </div>
    <br>
    <div id="back">
        <button><a href="/pages/secretary1.html" style="color: black; text-decoration: none;">Back</a></button>
    </div>
    <br>
    <h2>Today's Submitted Attendences</h2>
    <p>Attendances have been submitted for: </p>
    <div id='listOfSubmittedAttendancesDiv'>
        <ul id='listOfSubmittedAttendances'>

        </ul>
    </div>
    <h2>Report Todays Absences</h2>
    <div id="absDiv">
        <h3>Here are all the abscenses which are NOT declared: </h3>
        <h4>These students have associated parents on the system to report to: </h4>
        <div id="notDeclaredwithRents">
            <table id="notDeclaredwithRentsList">
                <thead>
                    <th>Student Id</th>
                    <th>Name</th>
                    <th>Status</th>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <button id="notify">Notify Parents</button>
        <h4>These students do NOT have associated parents on the system to report to (Secretary calls necessary): </h4>
        <div id="notDeclaredwithoutRents">
            <table id="notDeclaredwithoutRentsList">
                <thead>
                    <th>Student Id</th>
                    <th>Name</th>
                    <th>Status</th>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <h3>Here are all the abscenses which are declared: </h3>
        <div id="declared">
            <table id="declaredList">
                <thead>
                    <th>Student Id</th>
                    <th>Name</th>
                    <th>Status</th>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <h2>View/Modify a Submitted Attendance</h2>
    <div id='viewAttDiv'>
        <p>Select a class to view/modify it's submitted attendance for today:</p>
        <select id="classSelect">
            <option value="Selclass">Select a Class</option>
        </select>
    </div>

</body>

</html>